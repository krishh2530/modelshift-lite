<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ModelShift-Lite Dashboard</title>

  <link rel="stylesheet" href="{{ url_for('static', path='styles.css') }}?v=4.3" />
</head>

<body data-page="dash">
  <!-- Top Header -->
  <header class="topbar">
    <div class="topbar__left">
      <div class="brand">
        <span class="brand__caret">▸</span>
        <span class="brand__name">MODELSHIFT LITE</span>
        <span class="brand__version">SYS_MONITOR_V4.0.3</span>
      </div>
    </div>

    <div class="topbar__right">
      <div class="livepill" id="livePill">
        <span class="livepill__dot"></span>
        <span class="livepill__text">LIVE</span>
      </div>
      <div class="clock" id="clockText">--:--:--</div>
    </div>
  </header>

  <!-- Meta strip -->
  <section class="metastrip">
    <div class="metastrip__row">
      <div class="metaitem">
        <div class="metaitem__k">RUN_ID</div>
        <div class="metaitem__v" id="runIdText">—</div>
      </div>

      <div class="metaitem metaitem--center">
        <div class="metaitem__k">STATUS</div>
        <div class="metaitem__v">
          <span class="statusbadge" id="statusBadge">—</span>
        </div>
      </div>

      <div class="metaitem metaitem--right">
        <div class="metaitem__k">TIME</div>
        <div class="metaitem__v" id="timeZoneText">IST</div>
      </div>
    </div>

    <div class="metastrip__row metastrip__row--cards">
      <!-- Left: run meta -->
      <div class="panel panel--meta">
        <div class="panel__title">RUN META</div>
        <div class="panel__body monosmall">
          <div>
            <span class="muted">LATEST:</span>
            <span id="latestIdText">—</span>
            <span class="muted">/ PREV:</span>
            <span id="prevIdText">—</span>
          </div>
          <div class="sp8"></div>
          <div>
            <span class="muted">GENERATED:</span>
            <span id="latestGeneratedText">—</span>
            <span class="muted">/ PREV GENERATED:</span>
            <span id="prevGeneratedText">—</span>
          </div>
        </div>
      </div>

      <!-- Right: controls (DASHBOARD ONLY) -->
      <div class="panel panel--controls" id="dashControls">
        <div class="controls">
          <div class="controlgroup">
            <div class="controlgroup__label">ZOOM</div>
            <button class="btn btn--square" id="zoomMinus">−</button>
            <input class="slider" id="zoomSlider" type="range" min="1" max="10" step="1" value="3" />
            <button class="btn btn--square" id="zoomPlus">+</button>
            <div class="controlgroup__value" id="zoomValue">3</div>
          </div>

          <div class="controlgroup">
            <div class="controlgroup__label">SPEED</div>
            <button class="btn btn--square" id="speedMinus">−</button>
            <input class="slider slider--red" id="speedSlider" type="range" min="1" max="12" step="1" value="4" />
            <button class="btn btn--square" id="speedPlus">+</button>
            <div class="controlgroup__value" id="speedValue">4</div>
            <div class="controlgroup__sub" id="fpsText">— FPS</div>
          </div>

          <div class="controlgroup controlgroup--actions">
            <button class="btn btn--primary" id="playBtn">PLAY</button>
            <button class="btn" id="resetBtn">RESET</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main content -->
  <main class="wrap">
    <!-- DASH -->
    <section class="page active" id="page-dash">
      <h1 class="h1">| DASHBOARD</h1>

      <div class="block">
        <div class="block__head">
          <div class="block__title">LATEST RUN</div>
          <div class="block__actions">
            <button class="btn btn--primary" id="exportBtn">EXPORT REPORT</button>
          </div>
        </div>

        <div class="chartbox">
          <canvas id="chartLatest"></canvas>
          <div class="chartnote" id="latestChartNote">—</div>
        </div>

        <div class="cards4">
          <div class="kpi">
            <div class="kpi__k">CLEAN HEALTH</div>
            <div class="kpi__v" id="latestCleanHealth">—</div>
          </div>
          <div class="kpi kpi--warn">
            <div class="kpi__k">DRIFTED HEALTH</div>
            <div class="kpi__v" id="latestDriftedHealth">—</div>
          </div>
          <div class="kpi">
            <div class="kpi__k">PRED KS (DRIFT)</div>
            <div class="kpi__v" id="latestPredKs">—</div>
          </div>
          <div class="kpi">
            <div class="kpi__k">Δ ENTROPY</div>
            <div class="kpi__v" id="latestDeltaEntropy">—</div>
          </div>
        </div>

        <div class="strip" id="latestMostDrifted">
          MOST DRIFTED FEATURE (LAST WINDOW): —
        </div>

        <!-- ✅ NEW: Evaluation metrics (Latest) injected here by app.js -->
        <div class="sp8"></div>
        <div class="hint">
          Evaluation metrics (Accuracy / F1 / ROC-AUC / RMSE etc.) appear here when labels are available in the dataset.
        </div>
        <div class="sp8"></div>
        <div id="evalLatestBox"></div>
      </div>

      <div class="block">
        <div class="block__title">PREVIOUS RUN</div>
        <div class="chartbox">
          <canvas id="chartPrevious"></canvas>
          <div class="chartnote" id="prevChartNote">—</div>
        </div>

        <div class="cards4">
          <div class="kpi">
            <div class="kpi__k">CLEAN HEALTH</div>
            <div class="kpi__v" id="prevCleanHealth">—</div>
          </div>
          <div class="kpi">
            <div class="kpi__k">DRIFTED HEALTH</div>
            <div class="kpi__v" id="prevDriftedHealth">—</div>
          </div>
          <div class="kpi">
            <div class="kpi__k">PRED KS</div>
            <div class="kpi__v" id="prevPredKs">—</div>
          </div>
          <div class="kpi">
            <div class="kpi__k">Δ ENTROPY</div>
            <div class="kpi__v" id="prevDeltaEntropy">—</div>
          </div>
        </div>

        <!-- ✅ NEW: Evaluation metrics (Previous) injected here by app.js -->
        <div class="sp8"></div>
        <div id="evalPrevBox"></div>
      </div>

      <div class="block">
        <div class="block__title">PERFORMANCE LEDGER</div>
        <div class="tablewrap">
          <table class="table">
            <thead>
              <tr>
                <th>GENERATED_AT</th>
                <th>RUN_ID</th>
                <th>STATUS</th>
                <th>DRIFTED_HEALTH</th>
                <th>PRED_KS</th>
              </tr>
            </thead>
            <tbody id="ledgerBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ANALYSIS -->
    <section class="page" id="page-analysis">
      <h1 class="h1">| ANALYSIS</h1>

      <div class="block">
        <div class="block__title">INPUTS (PROOF)</div>
        <div class="codebox">
          <pre id="analysisJson">Loading…</pre>
        </div>

        <div class="hint">
          This page shows the exact JSON used by the UI. If any KPI looks “wrong”, compare it here first.
        </div>
      </div>
    </section>

    <!-- ALERTS -->
    <section class="page" id="page-alerts">
      <h1 class="h1">| ALERTS</h1>
      <div class="block">
        <div class="alertbox" id="alertBox">Loading…</div>
      </div>
    </section>

    <!-- CONFIG -->
    <section class="page" id="page-config">
      <h1 class="h1">| CONFIG</h1>

      <div class="block">
        <div class="block__title">UI</div>
        <div class="configrow">
          <button class="btn" id="themeBtn">TOGGLE THEME</button>

          <label class="check">
            <input type="checkbox" id="syncAxesChk" checked />
            <span>SYNC AXES (LATEST + PREV)</span>
          </label>

          <label class="check">
            <input type="checkbox" id="loopChk" checked />
            <span>LOOP PLAYBACK</span>
          </label>
        </div>

        <div class="hint">NOTE: This only changes dashboard visualization, not model behavior.</div>
      </div>

      <div class="block">
        <div class="block__title">ABOUT</div>
        <div class="about">
          <p><b>ModelShift-Lite</b> monitors an ML model in production and flags drift by comparing a <b>baseline</b> distribution vs <b>live</b> data.</p>
          <ul>
            <li><b>Clean Health</b>: stability score when live resembles baseline.</li>
            <li><b>Drifted Health</b>: stability score under detected shift.</li>
            <li><b>PRED_KS</b>: KS distance on prediction distribution (higher = more drift).</li>
            <li><b>Δ Entropy</b>: change in entropy between baseline and live.</li>
            <li><b>Most Drifted Feature</b>: feature with highest KS distance in last window.</li>
            <li><b>Evaluation Metrics</b>: Accuracy / Precision / Recall / F1 / ROC-AUC / RMSE etc. (requires ground-truth labels).</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- HISTORY -->
    <section class="page" id="page-history">
      <h1 class="h1">| HISTORY</h1>

      <div class="block">
        <div class="block__head">
          <div class="block__title">SAVED RUNS</div>
          <div class="block__actions">
            <button class="btn" id="clearHistoryBtn">REFRESH HISTORY</button>
          </div>
        </div>

        <div class="hint">
          History is fetched from the server (<span class="muted">dashboard_web/data/runs</span>) using <span class="muted">/api/history</span>.
          It shows previous RUN_IDs with their generated timestamps and KPIs.
        </div>

        <div class="tablewrap" style="margin-top:10px;">
          <table class="table">
            <thead>
              <tr>
                <th>SAVED_AT</th>
                <th>GENERATED_AT</th>
                <th>RUN_ID</th>
                <th>STATUS</th>
                <th>CLEAN</th>
                <th>DRIFTED</th>
                <th>PRED_KS</th>
                <th>ΔENTROPY</th>
              </tr>
            </thead>
            <tbody id="historyBody"></tbody>
          </table>
        </div>

        <div class="hint" style="margin-top:10px;">
          Tip: This will show 2 rows right now (latest + previous). As you generate more runs, it will grow automatically.
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom nav -->
  <nav class="bottomnav">
    <button class="navbtn active" data-page="dash">
      <div class="navbtn__icon">▦</div>
      <div class="navbtn__label">DASH</div>
    </button>
    <button class="navbtn" data-page="analysis">
      <div class="navbtn__icon">▤</div>
      <div class="navbtn__label">ANALYSIS</div>
    </button>
    <button class="navbtn" data-page="alerts">
      <div class="navbtn__icon">◌</div>
      <div class="navbtn__label">ALERTS</div>
    </button>
    <button class="navbtn" data-page="config">
      <div class="navbtn__icon">⚙</div>
      <div class="navbtn__label">CONFIG</div>
    </button>
    <button class="navbtn" data-page="history">
      <div class="navbtn__icon">⧉</div>
      <div class="navbtn__label">HISTORY</div>
    </button>
  </nav>

  <script defer src="{{ url_for('static', path='app.js') }}?v=4.3"></script>
</body>
</html>
